package com.ahthek;

import java.io.File;
import java.io.IOException;
import java.util.ArrayList;
import java.util.Arrays;
import java.util.List;
import java.util.ResourceBundle;
import java.util.prefs.Preferences;

import javafx.collections.FXCollections;
import javafx.collections.ObservableList;
import javafx.event.ActionEvent;
import javafx.fxml.FXML;
import javafx.fxml.Initializable;
import javafx.scene.Node;
import javafx.scene.control.TableColumn;
import javafx.scene.control.TableView;
import javafx.scene.control.TextField;
import javafx.scene.control.cell.PropertyValueFactory;
import javafx.stage.FileChooser;
import javafx.stage.FileChooser.ExtensionFilter;
import javafx.stage.Stage;
import java.net.URL;

public class UfcController implements Initializable{
  Preferences preferences = Preferences.userNodeForPackage(UfcController.class);

  @FXML
  private void switchToBat() throws IOException {
    MainApp.setRoot("batCombine");
  }

  @FXML
  private void swtichToMain() throws IOException {
    MainApp.setRoot("main");
  }

  @FXML
  private TextField mltFileTextField, txtFileTextField;

  @FXML
  private void selectMltFile(ActionEvent event) throws IOException {
    ExtensionFilter allFilter = new ExtensionFilter("All files", "*.*");
    ExtensionFilter mltFilter = new ExtensionFilter("MLT files", "*.mlt");
    selectFile(event, "Select .mlt file", Arrays.asList(allFilter, mltFilter), mltFilter, mltFileTextField);
  }

  @FXML
  private void selectChapterFile(ActionEvent event) throws IOException {
    ExtensionFilter allFilter = new ExtensionFilter("All files", "*.*");
    ExtensionFilter txtFilter = new ExtensionFilter("TXT files", "*.txt");
    selectFile(event, "Select .txt file", Arrays.asList(allFilter, txtFilter), txtFilter, txtFileTextField);
  }

  private void selectFile(
    ActionEvent event, String title, List<ExtensionFilter> filters, ExtensionFilter selectedFilter, TextField textField
  ) throws IOException {
    FileChooser fileChooser = new FileChooser();
    fileChooser.setTitle(title);
    fileChooser.setInitialDirectory(new File(preferences.get("lastUsedDir", System.getProperty("user.home"))));
    fileChooser.getExtensionFilters().addAll(filters);
    fileChooser.setSelectedExtensionFilter(selectedFilter);
    Stage stage = (Stage)((Node) event.getSource()).getScene().getWindow();
    File selectedFile = fileChooser.showOpenDialog(stage);
    if (selectedFile != null) {
      textField.setText(selectedFile.getAbsolutePath());
      preferences.put("lastUsedDir", selectedFile.getParent());
    }
  }

  public static long convertDurationToMillis(String duration) {
    String[] parts = duration.split(":");
    long hours = Long.parseLong(parts[0]);
    long minutes = Long.parseLong(parts[1]);
    String[] secondsAndMillis = parts[2].split("\\.");
    long seconds = Long.parseLong(secondsAndMillis[0]);
    long milliseconds = Long.parseLong(secondsAndMillis[1]);

    return hours * 3600000 + minutes * 60000 + seconds * 1000 + milliseconds;
  }

  @FXML
  private TableView<Chapter> chapterTableView;
  @FXML
  private TableColumn<Chapter, String> startTableColumn;

  @FXML
  private TableColumn<Chapter, String> endTableColumn;

  @FXML
  private TableColumn<Chapter, String> descriptionTableColumn;

  private final ObservableList<Chapter> data = FXCollections.observableArrayList();

  @Override
  public void initialize(URL url, ResourceBundle rb) {
    startTableColumn.setCellValueFactory(new PropertyValueFactory<>("start"));
    endTableColumn.setCellValueFactory(new PropertyValueFactory<>("end"));
    descriptionTableColumn.setCellValueFactory(new PropertyValueFactory<>("description"));
    
    chapterTableView.setItems(data);
  }

  @FXML
  private void loadTable() {
    // data.clear();

    // sample data
    // List<Chapter> chapterList = new ArrayList<>();
    data.add(new Chapter("00:44:37.333", "01:07:49.267", "Mitch Raposo vs. Andre Lima"));
    data.add(new Chapter("01:15:10.833", "01:37:46.800", "Ailin Perez vs. Joselyne Edwards"));
    data.add(new Chapter("01:44:43.433", "02:07:25.400", "Mickey Gall vs. Bassil Hafez"));
// System.out.println(data);
    // data.addAll(chapterList);
  }

  @FXML
  private void generateFiles() throws IOException {
    
  }
}
